#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Some .xpm files in ksnake contain binary data at the end.
This is a copy of the same image but in FITS format.
Those files have been generated by xv 3.10a which had 
this bug:

By cleverly harnessing the amazing power of a missing 'break' statement, xv 
was writing XPM files with a FITS version of the image conveniently tacked on 
the end. Hilarity ensues. 

(cited from http://www.trilon.com/xv/downloads.html)
"""

import os

def hasFITS(lines):
    return any('SIMPLE  =' in x for x in lines)

for dirpath, _, filenames in os.walk('.'):
    for filename in filenames:
        if filename.endswith('.xpm'):
            fullName = os.path.join(dirpath, filename)
            with open(fullName, 'r') as xpmFile:
                lines = xpmFile.readlines()
                xpmFile.close()
            if hasFITS(lines):
                with open(fullName,'w') as xpmFile:
                    for line in lines:
                        if 'SIMPLE  =' in line:
                            break
                        xpmFile.write(line)
                    xpmFile.close()
            xpmFile.close()
